<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>골프장 예약 시스템</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
        // Firebase 설정
        const firebaseConfig = {
            apiKey: "AIzaSyBXvjwzG6qpgW6W9H6-KBeXeJcqS1ZCdLA",
            authDomain: "reservation-344b6.firebaseapp.com",
            projectId: "reservation-344b6",
            storageBucket: "reservation-344b6.appspot.com",
            messagingSenderId: "191262639704",
            appId: "1:191262639704:web:2c51ae1636eda33cfa2c2d"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // Google 로그인 함수
        const provider = new firebase.auth.GoogleAuthProvider();
        if (/Mobi|Android/i.test(navigator.userAgent)) {
            // 모바일 환경에서는 Redirect 방식 사용
            auth.signInWithRedirect(provider);
        } else {
            // 데스크톱 환경에서는 Popup 방식 사용
            auth.signInWithPopup(provider).then(result => {
                document.getElementById("login-section").style.display = "none";
                document.getElementById("booking-section").style.display = "block";
                document.getElementById("admin-section").style.display = "block";
                loadBookings(); // 예약 목록 불러오기
            }).catch(error => {
                console.error("로그인 오류: ", error);
            });
        }

        // 예약 신청 함수
        function bookTimeSlot() {
        const user = firebase.auth().currentUser;
        if (!user) {
            alert("로그인이 필요합니다.");
            return;
        }

        const date = document.getElementById("date").value;
        const time = document.getElementById("time").value;
        const people = document.getElementById("people").value;

        if (!date || !time || !people) {
            alert("날짜, 시간, 인원수를 입력해주세요.");
            return;
        }

            db.collection("bookings").add({
                user: user.email,
                date: date,
                time: time,
                people: parseInt(people), // 숫자로 변환
                status: "대기 중"
            }).then(() => {
                alert("예약 요청이 완료되었습니다.");
                console.log("예약 성공:", date, time, people);
            }).catch(error => {
                console.error("예약 오류:", error);
            });
        }

        // 예약 목록 불러오기 (관리자용)
        function loadBookings() {
            db.collection("bookings").get().then(querySnapshot => {
                const bookingList = document.getElementById("booking-list");
                bookingList.innerHTML = "";
                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    const bookingItem = document.createElement("div");
                    bookingItem.innerHTML = `
                        <p>${data.date} ${data.time} - ${data.user} (${data.people}명) - 상태: ${data.status}
                        <button onclick="approveBooking('${doc.id}')">승인</button>
                        <button onclick="rejectBooking('${doc.id}')">거절</button></p>
                    `;
                    bookingList.appendChild(bookingItem);
                });
            });
        }

        // 예약 승인 함수
        function approveBooking(id) {
            db.collection("bookings").doc(id).update({
                status: "승인됨"
            }).then(() => {
                alert("예약이 승인되었습니다.");
                loadBookings();
            });
        }

        // 예약 거절 함수
        function rejectBooking(id) {
            db.collection("bookings").doc(id).update({
                status: "거절됨"
            }).then(() => {
                alert("예약이 거절되었습니다.");
                loadBookings();
            });
        }
    </script>
</head>
<body>
    <!-- 로그인 섹션 -->
    <div id="login-section">
        <h2>Google 로그인</h2>
        <button onclick="googleLogin()">Google 계정으로 로그인</button>
    </div>
    
    <!-- 예약 신청 섹션 -->
    <div id="booking-section" style="display:none;">
        <h2>골프장 예약</h2>
        <label for="date">날짜:</label>
        <input type="date" id="date"><br>
        
        <label for="time">시간:</label>
        <select id="time">
            <option value="08:00">08:00</option>
            <option value="09:00">09:00</option>
            <option value="10:00">10:00</option>
            <option value="11:00">11:00</option>
        </select><br>
        
        <label for="people">인원수:</label>
        <input type="number" id="people" min="1" max="4"><br>
        
        <button onclick="bookTimeSlot()">예약 신청</button>
    </div>
    
    <!-- 관리자 섹션 -->
    <div id="admin-section" style="display:none;">
        <h2>관리자 모드 - 예약 승인</h2>
        <div id="booking-list"></div>
    </div>
</body>
</html>
